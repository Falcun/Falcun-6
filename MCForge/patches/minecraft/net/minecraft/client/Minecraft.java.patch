--- ../src-base/minecraft/net/minecraft/client/Minecraft.java
+++ ../src-work/minecraft/net/minecraft/client/Minecraft.java
@@ -1,41 +1,7 @@
 package net.minecraft.client;
 
 import com.google.common.collect.Iterables;
-import com.google.common.collect.Lists;
-import com.google.common.collect.Maps;
-import com.google.common.collect.Queues;
-import com.google.common.collect.Sets;
-import com.google.common.util.concurrent.Futures;
-import com.google.common.util.concurrent.ListenableFuture;
-import com.google.common.util.concurrent.ListenableFutureTask;
-import com.mojang.authlib.GameProfile;
-import com.mojang.authlib.minecraft.MinecraftSessionService;
-import com.mojang.authlib.properties.Property;
-import com.mojang.authlib.properties.PropertyMap;
-import com.mojang.authlib.yggdrasil.YggdrasilAuthenticationService;
-import java.awt.image.BufferedImage;
-import java.io.File;
-import java.io.IOException;
-import java.io.InputStream;
-import java.net.Proxy;
-import java.net.SocketAddress;
-import java.nio.ByteBuffer;
-import java.nio.ByteOrder;
-import java.text.DecimalFormat;
-import java.text.SimpleDateFormat;
-import java.util.Collections;
-import java.util.Date;
-import java.util.Iterator;
-import java.util.List;
-import java.util.Map;
-import java.util.Queue;
-import java.util.Set;
-import java.util.UUID;
-import java.util.concurrent.Callable;
-import java.util.concurrent.Executors;
-import java.util.concurrent.FutureTask;
-import javax.imageio.ImageIO;
-import net.minecraft.block.Block;
+
 import net.minecraft.block.material.Material;
 import net.minecraft.client.audio.MusicTicker;
 import net.minecraft.client.audio.SoundHandler;
@@ -57,7 +23,6 @@
 import net.minecraft.client.gui.inventory.GuiInventory;
 import net.minecraft.client.gui.stream.GuiStreamUnavailable;
 import net.minecraft.client.main.GameConfiguration;
-import net.minecraft.client.multiplayer.GuiConnecting;
 import net.minecraft.client.multiplayer.PlayerControllerMP;
 import net.minecraft.client.multiplayer.ServerData;
 import net.minecraft.client.multiplayer.WorldClient;
@@ -112,20 +77,12 @@
 import net.minecraft.crash.CrashReport;
 import net.minecraft.crash.CrashReportCategory;
 import net.minecraft.entity.Entity;
-import net.minecraft.entity.EntityLeashKnot;
-import net.minecraft.entity.EntityList;
 import net.minecraft.entity.boss.BossStatus;
-import net.minecraft.entity.item.EntityArmorStand;
-import net.minecraft.entity.item.EntityBoat;
-import net.minecraft.entity.item.EntityItemFrame;
-import net.minecraft.entity.item.EntityMinecart;
-import net.minecraft.entity.item.EntityPainting;
 import net.minecraft.entity.player.EntityPlayer;
 import net.minecraft.entity.player.InventoryPlayer;
 import net.minecraft.init.Bootstrap;
 import net.minecraft.init.Items;
 import net.minecraft.item.Item;
-import net.minecraft.item.ItemBlock;
 import net.minecraft.item.ItemStack;
 import net.minecraft.nbt.NBTTagCompound;
 import net.minecraft.nbt.NBTTagList;
@@ -135,7 +92,6 @@
 import net.minecraft.network.handshake.client.C00Handshake;
 import net.minecraft.network.login.client.C00PacketLoginStart;
 import net.minecraft.network.play.client.C16PacketClientStatus;
-import net.minecraft.profiler.IPlayerUsage;
 import net.minecraft.profiler.PlayerUsageSnooper;
 import net.minecraft.profiler.Profiler;
 import net.minecraft.server.MinecraftServer;
@@ -147,7 +103,6 @@
 import net.minecraft.util.BlockPos;
 import net.minecraft.util.ChatComponentText;
 import net.minecraft.util.FrameTimer;
-import net.minecraft.util.IThreadListener;
 import net.minecraft.util.MathHelper;
 import net.minecraft.util.MinecraftError;
 import net.minecraft.util.MouseHelper;
@@ -167,8 +122,184 @@
 import net.minecraft.world.storage.ISaveFormat;
 import net.minecraft.world.storage.ISaveHandler;
 import net.minecraft.world.storage.WorldInfo;
+
+import net.minecraft.block.material.Material;
+import net.minecraft.client.audio.MusicTicker;
+import net.minecraft.client.audio.SoundHandler;
+import net.minecraft.client.entity.EntityPlayerSP;
+import net.minecraft.client.gui.FontRenderer;
+import net.minecraft.client.gui.GuiChat;
+import net.minecraft.client.gui.GuiControls;
+import net.minecraft.client.gui.GuiGameOver;
+import net.minecraft.client.gui.GuiIngame;
+import net.minecraft.client.gui.GuiIngameMenu;
+import net.minecraft.client.gui.GuiMainMenu;
+import net.minecraft.client.gui.GuiMemoryErrorScreen;
+import net.minecraft.client.gui.GuiScreen;
+import net.minecraft.client.gui.GuiSleepMP;
+import net.minecraft.client.gui.GuiYesNo;
+import net.minecraft.client.gui.GuiYesNoCallback;
+import net.minecraft.client.gui.ScaledResolution;
+import net.minecraft.client.gui.achievement.GuiAchievement;
+import net.minecraft.client.gui.inventory.GuiInventory;
+import net.minecraft.client.gui.stream.GuiStreamUnavailable;
+import net.minecraft.client.main.GameConfiguration;
+import net.minecraft.client.multiplayer.PlayerControllerMP;
+import net.minecraft.client.multiplayer.ServerData;
+import net.minecraft.client.multiplayer.WorldClient;
+import net.minecraft.client.network.NetHandlerLoginClient;
+import net.minecraft.client.network.NetHandlerPlayClient;
+import net.minecraft.client.particle.EffectRenderer;
+import net.minecraft.client.renderer.BlockRendererDispatcher;
+import net.minecraft.client.renderer.EntityRenderer;
+import net.minecraft.client.renderer.GlStateManager;
+import net.minecraft.client.renderer.ItemRenderer;
+import net.minecraft.client.renderer.OpenGlHelper;
+import net.minecraft.client.renderer.RenderGlobal;
+import net.minecraft.client.renderer.Tessellator;
+import net.minecraft.client.renderer.WorldRenderer;
+import net.minecraft.client.renderer.chunk.RenderChunk;
+import net.minecraft.client.renderer.entity.RenderItem;
+import net.minecraft.client.renderer.entity.RenderManager;
+import net.minecraft.client.renderer.texture.DynamicTexture;
+import net.minecraft.client.renderer.texture.TextureManager;
+import net.minecraft.client.renderer.texture.TextureMap;
+import net.minecraft.client.renderer.vertex.DefaultVertexFormats;
+import net.minecraft.client.resources.DefaultResourcePack;
+import net.minecraft.client.resources.FoliageColorReloadListener;
+import net.minecraft.client.resources.GrassColorReloadListener;
+import net.minecraft.client.resources.I18n;
+import net.minecraft.client.resources.IReloadableResourceManager;
+import net.minecraft.client.resources.IResourceManager;
+import net.minecraft.client.resources.IResourcePack;
+import net.minecraft.client.resources.LanguageManager;
+import net.minecraft.client.resources.ResourceIndex;
+import net.minecraft.client.resources.ResourcePackRepository;
+import net.minecraft.client.resources.SimpleReloadableResourceManager;
+import net.minecraft.client.resources.SkinManager;
+import net.minecraft.client.resources.data.AnimationMetadataSection;
+import net.minecraft.client.resources.data.AnimationMetadataSectionSerializer;
+import net.minecraft.client.resources.data.FontMetadataSection;
+import net.minecraft.client.resources.data.FontMetadataSectionSerializer;
+import net.minecraft.client.resources.data.IMetadataSerializer;
+import net.minecraft.client.resources.data.LanguageMetadataSection;
+import net.minecraft.client.resources.data.LanguageMetadataSectionSerializer;
+import net.minecraft.client.resources.data.PackMetadataSection;
+import net.minecraft.client.resources.data.PackMetadataSectionSerializer;
+import net.minecraft.client.resources.data.TextureMetadataSection;
+import net.minecraft.client.resources.data.TextureMetadataSectionSerializer;
+import net.minecraft.client.resources.model.ModelManager;
+import net.minecraft.client.settings.GameSettings;
+import net.minecraft.client.settings.KeyBinding;
+import net.minecraft.client.shader.Framebuffer;
+import net.minecraft.client.stream.IStream;
+import net.minecraft.client.stream.NullStream;
+import net.minecraft.client.stream.TwitchStream;
+import net.minecraft.crash.CrashReport;
+import net.minecraft.crash.CrashReportCategory;
+import net.minecraft.entity.Entity;
+import net.minecraft.entity.boss.BossStatus;
+import net.minecraft.entity.player.EntityPlayer;
+import net.minecraft.entity.player.InventoryPlayer;
+import net.minecraft.init.Bootstrap;
+import net.minecraft.init.Items;
+import net.minecraft.item.Item;
+import net.minecraft.item.ItemStack;
+import net.minecraft.nbt.NBTTagCompound;
+import net.minecraft.nbt.NBTTagList;
+import net.minecraft.nbt.NBTTagString;
+import net.minecraft.network.EnumConnectionState;
+import net.minecraft.network.NetworkManager;
+import net.minecraft.network.handshake.client.C00Handshake;
+import net.minecraft.network.login.client.C00PacketLoginStart;
+import net.minecraft.network.play.client.C16PacketClientStatus;
+import net.minecraft.profiler.PlayerUsageSnooper;
+import net.minecraft.profiler.Profiler;
+import net.minecraft.server.MinecraftServer;
+import net.minecraft.server.integrated.IntegratedServer;
+import net.minecraft.stats.AchievementList;
+import net.minecraft.stats.IStatStringFormat;
+import net.minecraft.stats.StatFileWriter;
+import net.minecraft.tileentity.TileEntity;
+import net.minecraft.util.BlockPos;
+import net.minecraft.util.ChatComponentText;
+import net.minecraft.util.FrameTimer;
+import net.minecraft.util.MathHelper;
+import net.minecraft.util.MinecraftError;
+import net.minecraft.util.MouseHelper;
+import net.minecraft.util.MovementInputFromOptions;
+import net.minecraft.util.MovingObjectPosition;
+import net.minecraft.util.ReportedException;
+import net.minecraft.util.ResourceLocation;
+import net.minecraft.util.ScreenShotHelper;
+import net.minecraft.util.Session;
+import net.minecraft.util.Timer;
+import net.minecraft.util.Util;
+import net.minecraft.world.EnumDifficulty;
+import net.minecraft.world.WorldProviderEnd;
+import net.minecraft.world.WorldProviderHell;
+import net.minecraft.world.WorldSettings;
+import net.minecraft.world.chunk.storage.AnvilSaveConverter;
+import net.minecraft.world.storage.ISaveFormat;
+import net.minecraft.world.storage.ISaveHandler;
+import net.minecraft.world.storage.WorldInfo;
+
+import com.google.common.collect.Lists;
+import com.google.common.collect.Maps;
+import com.google.common.collect.Queues;
+import com.google.common.collect.Sets;
+import com.google.common.util.concurrent.Futures;
+import com.google.common.util.concurrent.ListenableFuture;
+import com.google.common.util.concurrent.ListenableFutureTask;
+import com.mojang.authlib.GameProfile;
+import com.mojang.authlib.minecraft.MinecraftSessionService;
+import com.mojang.authlib.properties.Property;
+import com.mojang.authlib.properties.PropertyMap;
+import com.mojang.authlib.yggdrasil.YggdrasilAuthenticationService;
+
+import mapwriter.Mw;
+
+import java.awt.image.BufferedImage;
+import java.io.File;
+import java.io.IOException;
+import java.io.InputStream;
+import java.net.Proxy;
+import java.net.SocketAddress;
+import java.nio.ByteBuffer;
+import java.nio.ByteOrder;
+import java.text.DecimalFormat;
+import java.text.SimpleDateFormat;
+import java.util.Collections;
+import java.util.Date;
+import java.util.Iterator;
+import java.util.List;
+import java.util.Map;
+import java.util.Queue;
+import java.util.Set;
+import java.util.UUID;
+import java.util.concurrent.Callable;
+import java.util.concurrent.Executors;
+import java.util.concurrent.FutureTask;
+import javax.imageio.ImageIO;
+
+import net.mattbenson.Wrapper;
+import net.mattbenson.events.Event;
+import net.mattbenson.events.types.entity.PlayerInteractEvent.Action;
+import net.mattbenson.events.types.entity.PlayerInteractEvent;
+import net.mattbenson.events.types.input.KeyDownEvent;
+import net.mattbenson.events.types.input.KeyUpEvent;
+import net.mattbenson.events.types.input.MouseDownEvent;
+import net.mattbenson.events.types.input.MouseMoveEvent;
+import net.mattbenson.events.types.render.gui.GuiInitEvent;
+import net.mattbenson.events.types.world.OnTickEvent;
+import net.mattbenson.events.types.world.WorldUnloadEvent;
+import net.mattbenson.web.FalcunAssetDownloader;
+import net.minecraft.profiler.IPlayerUsage;
+import net.minecraft.util.IThreadListener;
 import net.minecraftforge.fml.relauncher.Side;
 import net.minecraftforge.fml.relauncher.SideOnly;
+import net.optifine.CustomSky;
+
 import org.apache.commons.io.IOUtils;
 import org.apache.commons.lang3.Validate;
 import org.apache.logging.log4j.LogManager;
@@ -203,7 +334,7 @@
     private static Minecraft field_71432_P;
     public PlayerControllerMP field_71442_b;
     private boolean field_71431_Q;
-    private boolean field_175619_R = true;
+    public boolean field_175619_R = true;
     private boolean field_71434_R;
     private CrashReport field_71433_S;
     public int field_71443_c;
@@ -220,7 +351,7 @@
     private Entity field_175622_Z;
     public Entity field_147125_j;
     public EffectRenderer field_71452_i;
-    private final Session field_71449_j;
+    public Session field_71449_j;
     private boolean field_71445_n;
     public FontRenderer field_71466_p;
     public FontRenderer field_71464_q;
@@ -258,7 +389,7 @@
     public final Profiler field_71424_I = new Profiler();
     private long field_83002_am = -1L;
     private IReloadableResourceManager field_110451_am;
-    private final IMetadataSerializer field_110452_an = new IMetadataSerializer();
+    public final IMetadataSerializer field_110452_an = new IMetadataSerializer();
     private final List<IResourcePack> field_110449_ao = Lists.<IResourcePack>newArrayList();
     public final DefaultResourcePack field_110450_ap;
     private ResourcePackRepository field_110448_aq;
@@ -291,6 +422,16 @@
     {
         field_71432_P = this;
         this.field_71412_D = p_i45547_1_.field_178744_c.field_178760_a;
+        
+        Thread thread = new FalcunAssetDownloader();
+        thread.start();
+        
+        try {
+			thread.join();
+		} catch (InterruptedException e) {
+			e.printStackTrace();
+		}
+        
         this.field_110446_Y = p_i45547_1_.field_178744_c.field_178759_c;
         this.field_130070_K = p_i45547_1_.field_178744_c.field_178758_b;
         this.field_110447_Z = p_i45547_1_.field_178741_d.field_178755_b;
@@ -301,7 +442,6 @@
         this.field_152355_az = (new YggdrasilAuthenticationService(p_i45547_1_.field_178745_a.field_178751_c, UUID.randomUUID().toString())).createMinecraftSessionService();
         this.field_71449_j = p_i45547_1_.field_178745_a.field_178752_a;
         field_147123_G.info("Setting user: " + this.field_71449_j.func_111285_a());
-        field_147123_G.info("(Session ID is " + this.field_71449_j.func_111286_b() + ")");
         this.field_71459_aj = p_i45547_1_.field_178741_d.field_178756_a;
         this.field_71443_c = p_i45547_1_.field_178743_b.field_178764_a > 0 ? p_i45547_1_.field_178743_b.field_178764_a : 1;
         this.field_71440_d = p_i45547_1_.field_178743_b.field_178762_b > 0 ? p_i45547_1_.field_178743_b.field_178762_b : 1;
@@ -402,6 +542,8 @@
             this.field_71443_c = this.field_71474_y.field_92118_B;
             this.field_71440_d = this.field_71474_y.field_92119_C;
         }
+        
+        Wrapper.getInstance().FalcunInit();
 
         field_147123_G.info("LWJGL Version: " + Sys.getVersion());
         this.func_175594_ao();
@@ -415,10 +557,10 @@
         this.field_110451_am = new SimpleReloadableResourceManager(this.field_110452_an);
         this.field_135017_as = new LanguageManager(this.field_110452_an, this.field_71474_y.field_74363_ab);
         this.field_110451_am.func_110542_a(this.field_135017_as);
-        this.func_110436_a();
+        net.minecraftforge.fml.client.FMLClientHandler.instance().beginMinecraftLoading(this, this.field_110449_ao, this.field_110451_am);
         this.field_71446_o = new TextureManager(this.field_110451_am);
         this.field_110451_am.func_110542_a(this.field_71446_o);
-        this.func_180510_a(this.field_71446_o);
+        net.minecraftforge.fml.client.SplashProgress.drawVanillaScreen(this.field_71446_o);
         this.func_175595_al();
         this.field_152350_aA = new SkinManager(this.field_71446_o, new File(this.field_110446_Y, "skins"), this.field_152355_az);
         this.field_71469_aa = new AnvilSaveConverter(new File(this.field_71412_D, "saves"));
@@ -453,6 +595,8 @@
             }
         });
         this.field_71417_B = new MouseHelper();
+        net.minecraftforge.fml.common.ProgressManager.ProgressBar bar= net.minecraftforge.fml.common.ProgressManager.push("Rendering Setup", 5, true);
+        bar.step("GL Setup");
         this.func_71361_d("Pre startup");
         GlStateManager.func_179098_w();
         GlStateManager.func_179103_j(7425);
@@ -466,17 +610,21 @@
         GlStateManager.func_179096_D();
         GlStateManager.func_179128_n(5888);
         this.func_71361_d("Startup");
-        this.field_147128_au = new TextureMap("textures");
+        bar.step("Loading Texture Map");
+        this.field_147128_au = new TextureMap("textures",true);
         this.field_147128_au.func_147633_a(this.field_71474_y.field_151442_I);
         this.field_71446_o.func_110580_a(TextureMap.field_110575_b, this.field_147128_au);
         this.field_71446_o.func_110577_a(TextureMap.field_110575_b);
         this.field_147128_au.func_174937_a(false, this.field_71474_y.field_151442_I > 0);
+        bar.step("Loading Model Manager");
         this.field_175617_aL = new ModelManager(this.field_147128_au);
         this.field_110451_am.func_110542_a(this.field_175617_aL);
+        bar.step("Loading Item Renderer");
         this.field_175621_X = new RenderItem(this.field_71446_o, this.field_175617_aL);
         this.field_175616_W = new RenderManager(this.field_71446_o, this.field_175621_X);
         this.field_175620_Y = new ItemRenderer(this);
         this.field_110451_am.func_110542_a(this.field_175621_X);
+        bar.step("Loading Entity Renderer");
         this.field_71460_t = new EntityRenderer(this, this.field_110451_am);
         this.field_110451_am.func_110542_a(this.field_71460_t);
         this.field_175618_aM = new BlockRendererDispatcher(this.field_175617_aL.func_174954_c(), this.field_71474_y);
@@ -486,22 +634,30 @@
         this.field_71458_u = new GuiAchievement(this);
         GlStateManager.func_179083_b(0, 0, this.field_71443_c, this.field_71440_d);
         this.field_71452_i = new EffectRenderer(this.field_71441_e, this.field_71446_o);
+        net.minecraftforge.fml.common.ProgressManager.pop(bar);
+        net.minecraftforge.fml.client.FMLClientHandler.instance().finishMinecraftLoading();
+        
+        if (!Wrapper.getInstance().MinecraftInitEvent(this)) {
+        	System.exit(0);
+        }
+        
         this.func_71361_d("Post startup");
-        this.field_71456_v = new GuiIngame(this);
+        this.field_71456_v = new net.minecraftforge.client.GuiIngameForge(this);
 
         if (this.field_71475_ae != null)
         {
-            this.func_147108_a(new GuiConnecting(new GuiMainMenu(), this, this.field_71475_ae, this.field_71477_af));
+            net.minecraftforge.fml.client.FMLClientHandler.instance().connectToServerAtStartup(this.field_71475_ae, this.field_71477_af);
         }
         else
         {
             this.func_147108_a(new GuiMainMenu());
         }
 
-        this.field_71446_o.func_147645_c(this.field_152354_ay);
+        net.minecraftforge.fml.client.SplashProgress.clearVanillaResources(field_71446_o, field_152354_ay);
         this.field_152354_ay = null;
         this.field_71461_s = new LoadingScreenRenderer(this);
 
+        net.minecraftforge.fml.client.FMLClientHandler.instance().onInitializationComplete();
         if (this.field_71474_y.field_74353_u && !this.field_71431_Q)
         {
             this.func_71352_k();
@@ -681,21 +837,23 @@
         File file2 = new File(file1, "crash-" + (new SimpleDateFormat("yyyy-MM-dd_HH.mm.ss")).format(new Date()) + "-client.txt");
         Bootstrap.func_179870_a(p_71377_1_.func_71502_e());
 
+        int retVal;
         if (p_71377_1_.func_71497_f() != null)
         {
             Bootstrap.func_179870_a("#@!@# Game crashed! Crash report saved to: #@!@# " + p_71377_1_.func_71497_f());
-            System.exit(-1);
+            retVal = -1;
         }
         else if (p_71377_1_.func_147149_a(file2))
         {
             Bootstrap.func_179870_a("#@!@# Game crashed! Crash report saved to: #@!@# " + file2.getAbsolutePath());
-            System.exit(-1);
+            retVal = -1;
         }
         else
         {
             Bootstrap.func_179870_a("#@?@# Game crashed! Crash report could not be saved. #@?@#");
-            System.exit(-2);
+            retVal = -2;
         }
+        net.minecraftforge.fml.common.FMLCommonHandler.instance().handleExit(retVal);
     }
 
     public boolean func_152349_b()
@@ -883,11 +1041,19 @@
 
     public void func_147108_a(GuiScreen p_147108_1_)
     {
-        if (this.field_71462_r != null)
-        {
-            this.field_71462_r.func_146281_b();
+    	
+        GuiInitEvent event1 = new GuiInitEvent(p_147108_1_);
+        
+        Wrapper.getInstance().post(event1);
+        
+        if(event1.isCancelled()) {
+        	return;
         }
-
+        
+        if(event1.getTarget() != p_147108_1_) {
+        	p_147108_1_ = event1.getTarget();
+        }
+    	
         if (p_147108_1_ == null && this.field_71441_e == null)
         {
             p_147108_1_ = new GuiMainMenu();
@@ -897,6 +1063,17 @@
             p_147108_1_ = new GuiGameOver();
         }
 
+        GuiScreen old = this.field_71462_r;
+        net.minecraftforge.client.event.GuiOpenEvent event = new net.minecraftforge.client.event.GuiOpenEvent(p_147108_1_);
+
+        if (net.minecraftforge.common.MinecraftForge.EVENT_BUS.post(event)) return;
+
+        p_147108_1_ = event.gui;
+        if (old != null && p_147108_1_ != old)
+        {
+            old.func_146281_b();
+        }
+
         if (p_147108_1_ instanceof GuiMainMenu)
         {
             this.field_71474_y.field_74330_P = false;
@@ -913,6 +1090,9 @@
             int j = scaledresolution.func_78328_b();
             ((GuiScreen)p_147108_1_).func_146280_a(this, i, j);
             this.field_71454_w = false;
+            
+            Wrapper.getInstance().post(new GuiInitEvent.Post(p_147108_1_));
+            
         }
         else
         {
@@ -941,6 +1121,7 @@
     {
         try
         {
+        	Mw.getInstance().close();
             this.field_152353_at.func_152923_i();
             field_147123_G.info("Stopping!");
 
@@ -975,6 +1156,7 @@
 
         if (Display.isCreated() && Display.isCloseRequested())
         {
+        	Mw.getInstance().close();
             this.func_71400_g();
         }
 
@@ -1030,9 +1212,11 @@
 
         if (!this.field_71454_w)
         {
+            net.minecraftforge.fml.common.FMLCommonHandler.instance().onRenderTickStart(this.field_71428_T.field_74281_c);
             this.field_71424_I.func_76318_c("gameRenderer");
             this.field_71460_t.func_181560_a(this.field_71428_T.field_74281_c, i);
             this.field_71424_I.func_76319_b();
+            net.minecraftforge.fml.common.FMLCommonHandler.instance().onRenderTickEnd(this.field_71428_T.field_74281_c);
         }
 
         this.field_71424_I.func_76319_b();
@@ -1371,13 +1555,17 @@
 
         if (this.field_71429_W <= 0 && !this.field_71439_g.func_71039_bw())
         {
+        	if(!(Wrapper.getInstance().isOldAnimations() && Wrapper.getInstance().isOldAnimationsOldEat())) {
+        		if(this.field_71439_g.func_71039_bw()) return;
+  	    	}
+        	
             if (p_147115_1_ && this.field_71476_x != null && this.field_71476_x.field_72313_a == MovingObjectPosition.MovingObjectType.BLOCK)
             {
                 BlockPos blockpos = this.field_71476_x.func_178782_a();
 
                 if (this.field_71441_e.func_180495_p(blockpos).func_177230_c().func_149688_o() != Material.field_151579_a && this.field_71442_b.func_180512_c(blockpos, this.field_71476_x.field_178784_b))
                 {
-                    this.field_71452_i.func_180532_a(blockpos, this.field_71476_x.field_178784_b);
+                    this.field_71452_i.addBlockHitEffects(blockpos, this.field_71476_x);
                     this.field_71439_g.func_71038_i();
                 }
             }
@@ -1394,13 +1582,15 @@
         {
             this.field_71439_g.func_71038_i();
 
-            if (this.field_71476_x == null)
+            if (this.field_71476_x == null || this.field_71476_x.field_72313_a == MovingObjectPosition.MovingObjectType.MISS)
             {
                 field_147123_G.error("Null returned as \'hitResult\', this shouldn\'t happen!");
 
                 if (this.field_71442_b.func_78762_g())
                 {
-                    this.field_71429_W = 10;
+                	if (!Wrapper.getInstance().is18Hits()) {
+                        this.field_71429_W = 10;
+                	}
                 }
             }
             else
@@ -1463,15 +1653,22 @@
                     case BLOCK:
                         BlockPos blockpos = this.field_71476_x.func_178782_a();
 
-                        if (this.field_71441_e.func_180495_p(blockpos).func_177230_c().func_149688_o() != Material.field_151579_a)
+                        if (!this.field_71441_e.func_175623_d(blockpos))
                         {
                             int i = itemstack != null ? itemstack.field_77994_a : 0;
 
+                            if (!Wrapper.getInstance().post(new PlayerInteractEvent(Action.RIGHT_CLICK_BLOCK, blockpos, this.field_71441_e))) {
+                          	   return;
+                            }
+                            
+                            boolean result = !net.minecraftforge.event.ForgeEventFactory.onPlayerInteract(field_71439_g, net.minecraftforge.event.entity.player.PlayerInteractEvent.Action.RIGHT_CLICK_BLOCK, this.field_71441_e, blockpos, this.field_71476_x.field_178784_b, this.field_71476_x.field_72307_f).isCanceled();
+                            if (result) { //Forge: Kept separate to simplify patch
                             if (this.field_71442_b.func_178890_a(this.field_71439_g, this.field_71441_e, itemstack, blockpos, this.field_71476_x.field_178784_b, this.field_71476_x.field_72307_f))
                             {
                                 flag = false;
                                 this.field_71439_g.func_71038_i();
                             }
+                            }
 
                             if (itemstack == null)
                             {
@@ -1494,11 +1691,86 @@
             {
                 ItemStack itemstack1 = this.field_71439_g.field_71071_by.func_70448_g();
 
-                if (itemstack1 != null && this.field_71442_b.func_78769_a(this.field_71439_g, this.field_71441_e, itemstack1))
+                boolean result = !net.minecraftforge.event.ForgeEventFactory.onPlayerInteract(field_71439_g, net.minecraftforge.event.entity.player.PlayerInteractEvent.Action.RIGHT_CLICK_AIR, field_71441_e, null, null, null).isCanceled();
+                if (result && itemstack1 != null && this.field_71442_b.func_78769_a(this.field_71439_g, this.field_71441_e, itemstack1))
                 {
                     this.field_71460_t.field_78516_c.func_78445_c();
                 }
             }
+        } else {
+        	if (Wrapper.getInstance().isOldAnimations() && Wrapper.getInstance().isOldAnimationsOldEat()) {
+                this.field_71467_ac = 4;
+                boolean flag = true;
+                ItemStack itemstack = this.field_71439_g.field_71071_by.func_70448_g();
+
+                if (this.field_71476_x == null)
+                {
+                    field_147123_G.warn("Null returned as \'hitResult\', this shouldn\'t happen!");
+                }
+                else
+                {
+                    switch (this.field_71476_x.field_72313_a)
+                    {
+                        case ENTITY:
+
+                            if (this.field_71442_b.func_178894_a(this.field_71439_g, this.field_71476_x.field_72308_g, this.field_71476_x))
+                            {
+                                flag = false;
+                            }
+                            else if (this.field_71442_b.func_78768_b(this.field_71439_g, this.field_71476_x.field_72308_g))
+                            {
+                                flag = false;
+                            }
+
+                            break;
+                        case BLOCK:
+                            BlockPos blockpos = this.field_71476_x.func_178782_a();
+
+                            if (!this.field_71441_e.func_175623_d(blockpos))
+                            {
+                                int i = itemstack != null ? itemstack.field_77994_a : 0;
+
+                                if (!Wrapper.getInstance().post(new PlayerInteractEvent(Action.RIGHT_CLICK_BLOCK, blockpos, this.field_71441_e))) {
+                              	   return;
+                                }
+                                
+                                boolean result = !net.minecraftforge.event.ForgeEventFactory.onPlayerInteract(field_71439_g, net.minecraftforge.event.entity.player.PlayerInteractEvent.Action.RIGHT_CLICK_BLOCK, this.field_71441_e, blockpos, this.field_71476_x.field_178784_b, this.field_71476_x.field_72307_f).isCanceled();
+                                if (result) { //Forge: Kept separate to simplify patch
+                                if (this.field_71442_b.func_178890_a(this.field_71439_g, this.field_71441_e, itemstack, blockpos, this.field_71476_x.field_178784_b, this.field_71476_x.field_72307_f))
+                                {
+                                    flag = false;
+                                    this.field_71439_g.func_71038_i();
+                                }
+                                }
+
+                                if (itemstack == null)
+                                {
+                                    return;
+                                }
+
+                                if (itemstack.field_77994_a == 0)
+                                {
+                                    this.field_71439_g.field_71071_by.field_70462_a[this.field_71439_g.field_71071_by.field_70461_c] = null;
+                                }
+                                else if (itemstack.field_77994_a != i || this.field_71442_b.func_78758_h())
+                                {
+                                    this.field_71460_t.field_78516_c.func_78444_b();
+                                }
+                            }
+                    }
+                }
+
+                if (flag)
+                {
+                    ItemStack itemstack1 = this.field_71439_g.field_71071_by.func_70448_g();
+
+                    boolean result = !net.minecraftforge.event.ForgeEventFactory.onPlayerInteract(field_71439_g, net.minecraftforge.event.entity.player.PlayerInteractEvent.Action.RIGHT_CLICK_AIR, field_71441_e, null, null, null).isCanceled();
+                    if (result && itemstack1 != null && this.field_71442_b.func_78769_a(this.field_71439_g, this.field_71441_e, itemstack1))
+                    {
+                        this.field_71460_t.field_78516_c.func_78445_c();
+                    }
+                }
+        	}
         }
     }
 
@@ -1551,9 +1823,11 @@
                 this.func_147119_ah();
             }
 
-            Display.setFullscreen(this.field_71431_Q);
-            Display.setVSyncEnabled(this.field_71474_y.field_74352_v);
-            this.func_175601_h();
+            Display.setResizable(false);
+			Display.setResizable(true);
+			Display.setFullscreen(this.field_71431_Q);
+			Display.setVSyncEnabled(this.field_71474_y.field_74352_v);
+			this.func_175601_h();
         }
         catch (Exception exception)
         {
@@ -1593,11 +1867,20 @@
 
     public void func_71407_l() throws IOException
     {
+    	if(Minecraft.func_71410_x().field_71439_g != null && Minecraft.func_71410_x().field_71441_e != null) {
+    		
+    		if (!Wrapper.getInstance().post(new OnTickEvent())) {
+    			return;
+    		}
+    	}
+    	
         if (this.field_71467_ac > 0)
         {
             --this.field_71467_ac;
         }
 
+        net.minecraftforge.fml.common.FMLCommonHandler.instance().onPreClientTick();
+
         this.field_71424_I.func_76320_a("gui");
 
         if (!this.field_71445_n)
@@ -1690,11 +1973,21 @@
 
             while (Mouse.next())
             {
+                if (net.minecraftforge.client.ForgeHooksClient.postMouseEvent()) continue;
+
+                if (!Wrapper.getInstance().post(new MouseMoveEvent())) {
+                	continue;
+                }
+                
                 int i = Mouse.getEventButton();
                 KeyBinding.func_74510_a(i - 100, Mouse.getEventButtonState());
 
                 if (Mouse.getEventButtonState())
                 {
+                	  if (!Wrapper.getInstance().post(new MouseDownEvent(i))) {
+                		  continue;
+                	  }
+                	  
                     if (this.field_71439_g.func_175149_v() && i == 2)
                     {
                         this.field_71456_v.func_175187_g().func_175261_b();
@@ -1745,6 +2038,7 @@
                         this.field_71462_r.func_146274_d();
                     }
                 }
+                net.minecraftforge.fml.common.FMLCommonHandler.instance().fireMouseInput();
             }
 
             if (this.field_71429_W > 0)
@@ -1880,7 +2174,7 @@
                             this.field_71474_y.field_181657_aC = GuiScreen.func_175283_s();
                         }
 
-                        if (this.field_71474_y.field_151457_aa.func_151468_f())
+                        if (this.field_71474_y.field_151457_aa.func_151468_f() && !Wrapper.getInstance().isInPerspectiveMode())
                         {
                             ++this.field_71474_y.field_74320_O;
 
@@ -1923,6 +2217,7 @@
                         }
                     }
                 }
+                net.minecraftforge.fml.common.FMLCommonHandler.instance().fireKeyInput();
             }
 
             for (int l = 0; l < 9; ++l)
@@ -2119,14 +2414,21 @@
             this.field_71453_ak.func_74428_b();
         }
 
+        net.minecraftforge.fml.common.FMLCommonHandler.instance().onPostClientTick();
+
         this.field_71424_I.func_76319_b();
         this.field_71423_H = func_71386_F();
     }
 
     public void func_71371_a(String p_71371_1_, String p_71371_2_, WorldSettings p_71371_3_)
     {
+        net.minecraftforge.fml.client.FMLClientHandler.instance().startIntegratedServer(p_71371_1_, p_71371_2_, p_71371_3_);
         this.func_71403_a((WorldClient)null);
-        System.gc();
+       
+        if(!Wrapper.getInstance().isFastWorldLoading()) {
+        	System.gc();
+        }
+        
         ISaveHandler isavehandler = this.field_71469_aa.func_75804_a(p_71371_1_, false);
         WorldInfo worldinfo = isavehandler.func_75757_d();
 
@@ -2156,21 +2458,31 @@
             throw new ReportedException(crashreport);
         }
 
-        this.field_71461_s.func_73720_a(I18n.func_135052_a("menu.loadingLevel", new Object[0]));
+        if(!Wrapper.getInstance().isFastWorldLoading()) {
+        	this.field_71461_s.func_73720_a(I18n.func_135052_a("menu.loadingLevel", new Object[0]));
+        }
 
         while (!this.field_71437_Z.func_71200_ad())
         {
-            String s = this.field_71437_Z.func_71195_b_();
-
-            if (s != null)
+            if (!net.minecraftforge.fml.common.StartupQuery.check())
             {
-                this.field_71461_s.func_73719_c(I18n.func_135052_a(s, new Object[0]));
+                func_71403_a(null);
+                func_147108_a(null);
+                return;
             }
-            else
-            {
-                this.field_71461_s.func_73719_c("");
-            }
+            String s = this.field_71437_Z.func_71195_b_();
 
+            if(!Wrapper.getInstance().isFastWorldLoading()) {
+	            if (s != null)
+	            {
+	                this.field_71461_s.func_73719_c(I18n.func_135052_a(s, new Object[0]));
+	            }
+	            else
+	            {
+	                this.field_71461_s.func_73719_c("");
+	            }
+            }
+            
             try
             {
                 Thread.sleep(200L);
@@ -2185,8 +2497,14 @@
         SocketAddress socketaddress = this.field_71437_Z.func_147137_ag().func_151270_a();
         NetworkManager networkmanager = NetworkManager.func_150722_a(socketaddress);
         networkmanager.func_150719_a(new NetHandlerLoginClient(networkmanager, this, (GuiScreen)null));
-        networkmanager.func_179290_a(new C00Handshake(47, socketaddress.toString(), 0, EnumConnectionState.LOGIN));
-        networkmanager.func_179290_a(new C00PacketLoginStart(this.func_110432_I().func_148256_e()));
+        networkmanager.func_179290_a(new C00Handshake(47, socketaddress.toString(), 0, EnumConnectionState.LOGIN, true));
+        com.mojang.authlib.GameProfile gameProfile = this.func_110432_I().func_148256_e();
+        if (!this.func_110432_I().hasCachedProperties())
+        {
+            gameProfile = field_152355_az.fillProfileProperties(gameProfile, true); //Forge: Fill profile properties upon game load. Fixes MC-52974.
+            this.func_110432_I().setProperties(gameProfile.getProperties());
+        }
+        networkmanager.func_179290_a(new C00PacketLoginStart(gameProfile));
         this.field_71453_ak = networkmanager;
     }
 
@@ -2197,6 +2515,18 @@
 
     public void func_71353_a(WorldClient p_71353_1_, String p_71353_2_)
     {
+    	
+    	if(field_71441_e != null) {
+            if (p_71353_1_ != this.field_71441_e) {
+                this.field_71460_t.func_147701_i().func_148249_a();
+            }
+            //
+    		Wrapper.getInstance().post(new WorldUnloadEvent(field_71441_e));
+    		CustomSky.update();
+    	}
+    	
+        if (field_71441_e != null) net.minecraftforge.common.MinecraftForge.EVENT_BUS.post(new net.minecraftforge.event.world.WorldEvent.Unload(field_71441_e));
+
         if (p_71353_1_ == null)
         {
             NetHandlerPlayClient nethandlerplayclient = this.func_147114_u();
@@ -2210,6 +2540,18 @@
             {
                 this.field_71437_Z.func_71263_m();
                 this.field_71437_Z.func_175592_a();
+                if (field_71461_s != null)
+                {
+                    this.field_71461_s.func_73719_c(I18n.func_135052_a("forge.client.shutdown.internal"));
+                }
+                while (!field_71437_Z.func_71241_aa())
+                {
+                    try
+                    {
+                        Thread.sleep(10);
+                    }
+                    catch (InterruptedException ie) {}
+                }
             }
 
             this.field_71437_Z = null;
@@ -2232,6 +2574,7 @@
             this.field_71456_v.func_181029_i();
             this.func_71351_a((ServerData)null);
             this.field_71455_al = false;
+            net.minecraftforge.fml.client.FMLClientHandler.instance().handleClientWorldClosing(this.field_71441_e);
         }
 
         this.field_147127_av.func_147690_c();
@@ -2267,7 +2610,10 @@
             this.field_71439_g = null;
         }
 
-        System.gc();
+        if(!Wrapper.getInstance().isFastWorldLoading()) {
+        	System.gc();
+        }
+        
         this.field_71423_H = 0L;
     }
 
@@ -2336,126 +2682,10 @@
         if (this.field_71476_x != null)
         {
             boolean flag = this.field_71439_g.field_71075_bZ.field_75098_d;
-            int i = 0;
-            boolean flag1 = false;
-            TileEntity tileentity = null;
-            Item item;
-
-            if (this.field_71476_x.field_72313_a == MovingObjectPosition.MovingObjectType.BLOCK)
-            {
-                BlockPos blockpos = this.field_71476_x.func_178782_a();
-                Block block = this.field_71441_e.func_180495_p(blockpos).func_177230_c();
-
-                if (block.func_149688_o() == Material.field_151579_a)
-                {
-                    return;
-                }
-
-                item = block.func_180665_b(this.field_71441_e, blockpos);
-
-                if (item == null)
-                {
-                    return;
-                }
-
-                if (flag && GuiScreen.func_146271_m())
-                {
-                    tileentity = this.field_71441_e.func_175625_s(blockpos);
-                }
-
-                Block block1 = item instanceof ItemBlock && !block.func_149648_K() ? Block.func_149634_a(item) : block;
-                i = block1.func_176222_j(this.field_71441_e, blockpos);
-                flag1 = item.func_77614_k();
-            }
-            else
-            {
-                if (this.field_71476_x.field_72313_a != MovingObjectPosition.MovingObjectType.ENTITY || this.field_71476_x.field_72308_g == null || !flag)
-                {
-                    return;
-                }
-
-                if (this.field_71476_x.field_72308_g instanceof EntityPainting)
-                {
-                    item = Items.field_151159_an;
-                }
-                else if (this.field_71476_x.field_72308_g instanceof EntityLeashKnot)
-                {
-                    item = Items.field_151058_ca;
-                }
-                else if (this.field_71476_x.field_72308_g instanceof EntityItemFrame)
-                {
-                    EntityItemFrame entityitemframe = (EntityItemFrame)this.field_71476_x.field_72308_g;
-                    ItemStack itemstack = entityitemframe.func_82335_i();
-
-                    if (itemstack == null)
-                    {
-                        item = Items.field_151160_bD;
-                    }
-                    else
-                    {
-                        item = itemstack.func_77973_b();
-                        i = itemstack.func_77960_j();
-                        flag1 = true;
-                    }
-                }
-                else if (this.field_71476_x.field_72308_g instanceof EntityMinecart)
-                {
-                    EntityMinecart entityminecart = (EntityMinecart)this.field_71476_x.field_72308_g;
-
-                    switch (entityminecart.func_180456_s())
-                    {
-                        case FURNACE:
-                            item = Items.field_151109_aJ;
-                            break;
-                        case CHEST:
-                            item = Items.field_151108_aI;
-                            break;
-                        case TNT:
-                            item = Items.field_151142_bV;
-                            break;
-                        case HOPPER:
-                            item = Items.field_151140_bW;
-                            break;
-                        case COMMAND_BLOCK:
-                            item = Items.field_151095_cc;
-                            break;
-                        default:
-                            item = Items.field_151143_au;
-                    }
-                }
-                else if (this.field_71476_x.field_72308_g instanceof EntityBoat)
-                {
-                    item = Items.field_151124_az;
-                }
-                else if (this.field_71476_x.field_72308_g instanceof EntityArmorStand)
-                {
-                    item = Items.field_179565_cj;
-                }
-                else
-                {
-                    item = Items.field_151063_bx;
-                    i = EntityList.func_75619_a(this.field_71476_x.field_72308_g);
-                    flag1 = true;
-
-                    if (!EntityList.field_75627_a.containsKey(Integer.valueOf(i)))
-                    {
-                        return;
-                    }
-                }
-            }
-
             InventoryPlayer inventoryplayer = this.field_71439_g.field_71071_by;
 
-            if (tileentity == null)
-            {
-                inventoryplayer.func_146030_a(item, i, flag1, flag);
-            }
-            else
-            {
-                ItemStack itemstack1 = this.func_181036_a(item, i, tileentity);
-                inventoryplayer.func_70299_a(inventoryplayer.field_70461_c, itemstack1);
-            }
-
+            if (!net.minecraftforge.common.ForgeHooks.onPickBlock(this.field_71476_x, this.field_71439_g, this.field_71441_e)) return;
+            // We delete this code wholly instead of commenting it out, to make sure we detect changes in it between MC versions
             if (flag)
             {
                 int j = this.field_71439_g.field_71069_bz.field_75151_b.size() - 9 + inventoryplayer.field_70461_c;
@@ -2756,18 +2986,8 @@
 
     public static int func_71369_N()
     {
-        for (int i = 16384; i > 0; i >>= 1)
-        {
-            GL11.glTexImage2D(GL11.GL_PROXY_TEXTURE_2D, 0, GL11.GL_RGBA, i, i, 0, GL11.GL_RGBA, GL11.GL_UNSIGNED_BYTE, (ByteBuffer)((ByteBuffer)null));
-            int j = GL11.glGetTexLevelParameteri(GL11.GL_PROXY_TEXTURE_2D, 0, GL11.GL_TEXTURE_WIDTH);
-
-            if (j != 0)
-            {
-                return i;
-            }
-        }
-
-        return -1;
+        //Forge we redirect this to our code which caches the value before any splash screen stuff is done.
+        return net.minecraftforge.fml.client.SplashProgress.getMaxTextureSize();
     }
 
     public boolean func_70002_Q()
@@ -2912,6 +3132,20 @@
         {
             if (!(this.field_71462_r instanceof GuiControls) || ((GuiControls)this.field_71462_r).field_152177_g <= func_71386_F() - 20L)
             {
+            	
+            	boolean down = Keyboard.getEventKeyState();
+            	Event event = null;
+            	
+            	if(down) {
+            		event = new KeyDownEvent(i);
+            	} else {
+            		event = new KeyUpEvent(i);
+            	}
+
+                if (!Wrapper.getInstance().post(event)) {
+                	return;
+                }
+                
                 if (Keyboard.getEventKeyState())
                 {
                     if (i == this.field_71474_y.field_152396_an.func_151463_i())
@@ -2924,9 +3158,9 @@
                         {
                             this.func_147108_a(new GuiYesNo(new GuiYesNoCallback()
                             {
-                                public void func_73878_a(boolean p_73878_1_, int p_73878_2_)
+                                public void func_73878_a(boolean result, int id)
                                 {
-                                    if (p_73878_1_)
+                                    if (result)
                                     {
                                         Minecraft.this.func_152346_Z().func_152930_t();
                                     }
