--- ../src-base/minecraft/net/minecraft/client/renderer/VboRenderList.java
+++ ../src-work/minecraft/net/minecraft/client/renderer/VboRenderList.java
@@ -2,43 +2,109 @@
 
 import net.minecraft.client.renderer.chunk.RenderChunk;
 import net.minecraft.client.renderer.vertex.VertexBuffer;
+import net.minecraft.src.Config;
 import net.minecraft.util.EnumWorldBlockLayer;
-import net.minecraftforge.fml.relauncher.Side;
-import net.minecraftforge.fml.relauncher.SideOnly;
+import net.optifine.render.VboRegion;
+import net.optifine.shaders.ShadersRender;
 import org.lwjgl.opengl.GL11;
 
-@SideOnly(Side.CLIENT)
 public class VboRenderList extends ChunkRenderContainer
 {
+    private double viewEntityX;
+    private double viewEntityY;
+    private double viewEntityZ;
+
     public void func_178001_a(EnumWorldBlockLayer p_178001_1_)
     {
         if (this.field_178007_b)
         {
-            for (RenderChunk renderchunk : this.field_178009_a)
+            if (!Config.isRenderRegions())
             {
-                VertexBuffer vertexbuffer = renderchunk.func_178565_b(p_178001_1_.ordinal());
-                GlStateManager.func_179094_E();
-                this.func_178003_a(renderchunk);
-                renderchunk.func_178572_f();
-                vertexbuffer.func_177359_a();
-                this.func_178010_a();
-                vertexbuffer.func_177358_a(7);
-                GlStateManager.func_179121_F();
+                for (RenderChunk renderchunk1 : this.field_178009_a)
+                {
+                    VertexBuffer vertexbuffer1 = renderchunk1.func_178565_b(p_178001_1_.ordinal());
+                    GlStateManager.func_179094_E();
+                    this.func_178003_a(renderchunk1);
+                    renderchunk1.func_178572_f();
+                    vertexbuffer1.func_177359_a();
+                    this.func_178010_a();
+                    vertexbuffer1.func_177358_a(7);
+                    GlStateManager.func_179121_F();
+                }
             }
+            else
+            {
+                int i = Integer.MIN_VALUE;
+                int j = Integer.MIN_VALUE;
+                VboRegion vboregion = null;
 
+                for (RenderChunk renderchunk : this.field_178009_a)
+                {
+                    VertexBuffer vertexbuffer = renderchunk.func_178565_b(p_178001_1_.ordinal());
+                    VboRegion vboregion1 = vertexbuffer.getVboRegion();
+
+                    if (vboregion1 != vboregion || i != renderchunk.regionX || j != renderchunk.regionZ)
+                    {
+                        if (vboregion != null)
+                        {
+                            this.drawRegion(i, j, vboregion);
+                        }
+
+                        i = renderchunk.regionX;
+                        j = renderchunk.regionZ;
+                        vboregion = vboregion1;
+                    }
+
+                    vertexbuffer.func_177358_a(7);
+                }
+
+                if (vboregion != null)
+                {
+                    this.drawRegion(i, j, vboregion);
+                }
+            }
+
             OpenGlHelper.func_176072_g(OpenGlHelper.field_176089_P, 0);
             GlStateManager.func_179117_G();
             this.field_178009_a.clear();
         }
     }
 
-    private void func_178010_a()
+    public void func_178010_a()
     {
-        GL11.glVertexPointer(3, GL11.GL_FLOAT, 28, 0L);
-        GL11.glColorPointer(4, GL11.GL_UNSIGNED_BYTE, 28, 12L);
-        GL11.glTexCoordPointer(2, GL11.GL_FLOAT, 28, 16L);
-        OpenGlHelper.func_77472_b(OpenGlHelper.field_77476_b);
-        GL11.glTexCoordPointer(2, GL11.GL_SHORT, 28, 24L);
-        OpenGlHelper.func_77472_b(OpenGlHelper.field_77478_a);
+        if (Config.isShaders())
+        {
+            ShadersRender.setupArrayPointersVbo();
+        }
+        else
+        {
+            GL11.glVertexPointer(3, GL11.GL_FLOAT, 28, 0L);
+            GL11.glColorPointer(4, GL11.GL_UNSIGNED_BYTE, 28, 12L);
+            GL11.glTexCoordPointer(2, GL11.GL_FLOAT, 28, 16L);
+            OpenGlHelper.func_77472_b(OpenGlHelper.field_77476_b);
+            GL11.glTexCoordPointer(2, GL11.GL_SHORT, 28, 24L);
+            OpenGlHelper.func_77472_b(OpenGlHelper.field_77478_a);
+        }
     }
+
+    public void func_178004_a(double viewEntityXIn, double viewEntityYIn, double viewEntityZIn)
+    {
+        this.viewEntityX = viewEntityXIn;
+        this.viewEntityY = viewEntityYIn;
+        this.viewEntityZ = viewEntityZIn;
+        super.func_178004_a(viewEntityXIn, viewEntityYIn, viewEntityZIn);
+    }
+
+    private void drawRegion(int p_drawRegion_1_, int p_drawRegion_2_, VboRegion p_drawRegion_3_)
+    {
+        GlStateManager.func_179094_E();
+        this.preRenderRegion(p_drawRegion_1_, 0, p_drawRegion_2_);
+        p_drawRegion_3_.finishDraw(this);
+        GlStateManager.func_179121_F();
+    }
+
+    public void preRenderRegion(int p_preRenderRegion_1_, int p_preRenderRegion_2_, int p_preRenderRegion_3_)
+    {
+        GlStateManager.func_179109_b((float)((double)p_preRenderRegion_1_ - this.viewEntityX), (float)((double)p_preRenderRegion_2_ - this.viewEntityY), (float)((double)p_preRenderRegion_3_ - this.viewEntityZ));
+    }
 }
