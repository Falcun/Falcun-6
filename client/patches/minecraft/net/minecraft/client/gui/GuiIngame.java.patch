--- ../src-base/minecraft/net/minecraft/client/gui/GuiIngame.java
+++ ../src-work/minecraft/net/minecraft/client/gui/GuiIngame.java
@@ -1,11 +1,15 @@
 package net.minecraft.client.gui;
 
-import com.google.common.base.Predicate;
-import com.google.common.collect.Iterables;
-import com.google.common.collect.Lists;
 import java.util.Collection;
 import java.util.List;
 import java.util.Random;
+
+import com.google.common.base.Predicate;
+import com.google.common.collect.Iterables;
+import com.google.common.collect.Lists;
+
+import net.mattbenson.Wrapper;
+import net.mattbenson.events.types.render.RenderType;
 import net.minecraft.block.material.Material;
 import net.minecraft.client.Minecraft;
 import net.minecraft.client.renderer.GlStateManager;
@@ -32,6 +36,7 @@
 import net.minecraft.scoreboard.ScoreObjective;
 import net.minecraft.scoreboard.ScorePlayerTeam;
 import net.minecraft.scoreboard.Scoreboard;
+import net.minecraft.src.Config;
 import net.minecraft.util.BlockPos;
 import net.minecraft.util.EnumChatFormatting;
 import net.minecraft.util.FoodStats;
@@ -41,28 +46,40 @@
 import net.minecraft.util.ResourceLocation;
 import net.minecraft.util.StringUtils;
 import net.minecraft.world.border.WorldBorder;
-import net.minecraftforge.fml.relauncher.Side;
-import net.minecraftforge.fml.relauncher.SideOnly;
+import net.optifine.CustomColors;
 
-@SideOnly(Side.CLIENT)
 public class GuiIngame extends Gui
 {
-    protected static final ResourceLocation field_110329_b = new ResourceLocation("textures/misc/vignette.png");
-    protected static final ResourceLocation field_110330_c = new ResourceLocation("textures/gui/widgets.png");
-    protected static final ResourceLocation field_110328_d = new ResourceLocation("textures/misc/pumpkinblur.png");
+    private static final ResourceLocation field_110329_b = new ResourceLocation("textures/misc/vignette.png");
+    private static final ResourceLocation field_110330_c = new ResourceLocation("textures/gui/widgets.png");
+    private static final ResourceLocation field_110328_d = new ResourceLocation("textures/misc/pumpkinblur.png");
     protected final Random field_73842_c = new Random();
     protected final Minecraft field_73839_d;
-    protected final RenderItem field_73841_b;
+    private final RenderItem field_73841_b;
+
+    /** ChatGUI instance that retains all previous chat data */
     protected final GuiNewChat field_73840_e;
-    protected final GuiStreamIndicator field_152127_m;
+    private final GuiStreamIndicator field_152127_m;
     protected int field_73837_f;
+
+    /** The string specifying which record music is playing */
     protected String field_73838_g = "";
+
+    /** How many ticks the record playing message will be displayed */
     protected int field_73845_h;
     protected boolean field_73844_j;
+
+    /** Previous frame vignette brightness (slowly changes by 1% each frame) */
     public float field_73843_a = 1.0F;
+
+    /** Remaining ticks the item highlight should be visible */
     protected int field_92017_k;
+
+    /** The ItemStack that is currently being highlighted */
     protected ItemStack field_92016_l;
-    protected final GuiOverlayDebug field_175198_t;
+    private final GuiOverlayDebug field_175198_t;
+
+    /** The spectator GUI for this in-game GUI instance */
     protected final GuiSpectator field_175197_u;
     protected final GuiPlayerTabOverlay field_175196_v;
     protected int field_175195_w;
@@ -73,7 +90,11 @@
     protected int field_175193_B;
     protected int field_175194_C = 0;
     protected int field_175189_D = 0;
+
+    /** The last recorded system time */
     protected long field_175190_E = 0L;
+
+    /** Used with updateCounter to make the heart bar flash */
     protected long field_175191_F = 0L;
 
     public GuiIngame(Minecraft p_i46325_1_)
@@ -101,9 +122,10 @@
         int i = scaledresolution.func_78326_a();
         int j = scaledresolution.func_78328_b();
         this.field_73839_d.field_71460_t.func_78478_c();
+        
         GlStateManager.func_179147_l();
 
-        if (Minecraft.func_71375_t())
+        if (Config.isVignetteEnabled())
         {
             this.func_180480_a(this.field_73839_d.field_71439_g.func_70013_c(p_175180_1_), scaledresolution);
         }
@@ -139,16 +161,22 @@
         }
 
         GlStateManager.func_179131_c(1.0F, 1.0F, 1.0F, 1.0F);
+        
+        if (!Wrapper.getInstance().RenderEvent(RenderType.INGAME_OVERLAY, p_175180_1_)) {
+        	return;
+        }
+
         this.field_73839_d.func_110434_K().func_110577_a(field_110324_m);
         GlStateManager.func_179147_l();
 
-        if (this.func_175183_b())
+        if (this.func_175183_b() && Wrapper.getInstance().RenderEvent(RenderType.CROSSHAIR, p_175180_1_))
         {
             GlStateManager.func_179120_a(775, 769, 1, 0);
             GlStateManager.func_179141_d();
             this.func_73729_b(i / 2 - 7, j / 2 - 7, 0, 0, 16, 16);
         }
 
+        GlStateManager.func_179141_d();
         GlStateManager.func_179120_a(770, 771, 1, 0);
         this.field_73839_d.field_71424_I.func_76320_a("bossHealth");
         this.func_73828_d();
@@ -175,7 +203,7 @@
             }
 
             int k = (int)(220.0F * f1) << 24 | 1052704;
-            func_73734_a(0, 0, i, j, k);
+            drawRectangle(0, 0, i, j, k);
             GlStateManager.func_179141_d();
             GlStateManager.func_179126_j();
             this.field_73839_d.field_71424_I.func_76319_b();
@@ -284,10 +312,10 @@
 
             this.field_73839_d.field_71424_I.func_76319_b();
         }
-
+        
         Scoreboard scoreboard = this.field_73839_d.field_71441_e.func_96441_U();
         ScoreObjective scoreobjective = null;
-        ScorePlayerTeam scoreplayerteam = scoreboard.func_96509_i(this.field_73839_d.field_71439_g.func_70005_c_());
+        ScorePlayerTeam scoreplayerteam = scoreboard.func_96509_i(this.field_73839_d.field_71439_g.getCommandSenderName());
 
         if (scoreplayerteam != null)
         {
@@ -303,7 +331,9 @@
 
         if (scoreobjective1 != null)
         {
-            this.func_180475_a(scoreobjective1, scaledresolution);
+            if(Wrapper.getInstance().RenderEvent(RenderType.SCOREBOARD, p_175180_1_)) {
+            	this.func_180475_a(scoreobjective1, scaledresolution);
+            }
         }
 
         GlStateManager.func_179147_l();
@@ -317,14 +347,14 @@
         GlStateManager.func_179121_F();
         scoreobjective1 = scoreboard.func_96539_a(0);
 
-        if (!this.field_73839_d.field_71474_y.field_74321_H.func_151470_d() || this.field_73839_d.func_71387_A() && this.field_73839_d.field_71439_g.field_71174_a.func_175106_d().size() <= 1 && scoreobjective1 == null)
+        if (this.field_73839_d.field_71474_y.field_74321_H.func_151470_d() && (!this.field_73839_d.func_71387_A() || this.field_73839_d.field_71439_g.field_71174_a.func_175106_d().size() > 1 || scoreobjective1 != null))
         {
-            this.field_175196_v.func_175246_a(false);
+            this.field_175196_v.func_175246_a(true);
+            this.field_175196_v.func_175249_a(i, scoreboard, scoreobjective1);
         }
         else
         {
-            this.field_175196_v.func_175246_a(true);
-            this.field_175196_v.func_175249_a(i, scoreboard, scoreobjective1);
+            this.field_175196_v.func_175246_a(false);
         }
 
         GlStateManager.func_179131_c(1.0F, 1.0F, 1.0F, 1.0F);
@@ -406,6 +436,12 @@
         {
             this.field_73839_d.field_71424_I.func_76320_a("expLevel");
             int k1 = 8453920;
+
+            if (Config.isCustomColors())
+            {
+                k1 = CustomColors.getExpBarTextColor(k1);
+            }
+
             String s = "" + this.field_73839_d.field_71439_g.field_71068_ca;
             int l1 = (p_175176_1_.func_78326_a() - this.func_175179_f().func_78256_a(s)) / 2;
             int i1 = p_175176_1_.func_78328_b() - 31 - 4;
@@ -562,28 +598,32 @@
             String s2 = EnumChatFormatting.RED + "" + score1.func_96652_c();
             int k = j1 - j * this.func_175179_f().field_78288_b;
             int l = p_180475_2_.func_78326_a() - k1 + 2;
-            func_73734_a(l1 - 2, k, l, k + this.func_175179_f().field_78288_b, 1342177280);
+            drawRectangle(l1 - 2, k, l, k + this.func_175179_f().field_78288_b, 1342177280);
             this.func_175179_f().func_78276_b(s1, l1, k, 553648127);
             this.func_175179_f().func_78276_b(s2, l - this.func_175179_f().func_78256_a(s2), k, 553648127);
 
             if (j == collection.size())
             {
                 String s3 = p_180475_1_.func_96678_d();
-                func_73734_a(l1 - 2, k - this.func_175179_f().field_78288_b - 1, l, k - 1, 1610612736);
-                func_73734_a(l1 - 2, k - 1, l, k, 1342177280);
+                drawRectangle(l1 - 2, k - this.func_175179_f().field_78288_b - 1, l, k - 1, 1610612736);
+                drawRectangle(l1 - 2, k - 1, l, k, 1342177280);
                 this.func_175179_f().func_78276_b(s3, l1 + i / 2 - this.func_175179_f().func_78256_a(s3) / 2, k - this.func_175179_f().field_78288_b, 553648127);
             }
         }
     }
 
-    protected void func_180477_d(ScaledResolution p_180477_1_)
+    private void func_180477_d(ScaledResolution p_180477_1_)
     {
         if (this.field_73839_d.func_175606_aa() instanceof EntityPlayer)
         {
             EntityPlayer entityplayer = (EntityPlayer)this.field_73839_d.func_175606_aa();
             int i = MathHelper.func_76123_f(entityplayer.func_110143_aJ());
             boolean flag = this.field_175191_F > (long)this.field_73837_f && (this.field_175191_F - (long)this.field_73837_f) / 3L % 2L == 1L;
-
+            
+            if(Wrapper.getInstance().isOldAnimations() && Wrapper.getInstance().isOldAnimationsDisableHealthFlash()) {
+            	flag = false;
+            }
+            
             if (i < this.field_175194_C && entityplayer.field_70172_ad > 0)
             {
                 this.field_175190_E = Minecraft.func_71386_F();
@@ -710,30 +750,30 @@
                     }
                 }
 
-                if (f2 > 0.0F)
+                if (f2 <= 0.0F)
                 {
-                    if (f2 == f1 && f1 % 2.0F == 1.0F)
+                    if (i6 * 2 + 1 < i)
                     {
-                        this.func_73729_b(i4, j4, j6 + 153, 9 * k4, 9, 9);
+                        this.func_73729_b(i4, j4, j6 + 36, 9 * k4, 9, 9);
                     }
-                    else
+
+                    if (i6 * 2 + 1 == i)
                     {
-                        this.func_73729_b(i4, j4, j6 + 144, 9 * k4, 9, 9);
+                        this.func_73729_b(i4, j4, j6 + 45, 9 * k4, 9, 9);
                     }
-
-                    f2 -= 2.0F;
                 }
                 else
                 {
-                    if (i6 * 2 + 1 < i)
+                    if (f2 == f1 && f1 % 2.0F == 1.0F)
                     {
-                        this.func_73729_b(i4, j4, j6 + 36, 9 * k4, 9, 9);
+                        this.func_73729_b(i4, j4, j6 + 153, 9 * k4, 9, 9);
                     }
-
-                    if (i6 * 2 + 1 == i)
+                    else
                     {
-                        this.func_73729_b(i4, j4, j6 + 45, 9 * k4, 9, 9);
+                        this.func_73729_b(i4, j4, j6 + 144, 9 * k4, 9, 9);
                     }
+
+                    f2 -= 2.0F;
                 }
             }
 
@@ -745,50 +785,50 @@
 
                 for (int k6 = 0; k6 < 10; ++k6)
                 {
-                    int i7 = k1;
+                    int j7 = k1;
                     int l7 = 16;
-                    int j8 = 0;
+                    int k8 = 0;
 
                     if (entityplayer.func_70644_a(Potion.field_76438_s))
                     {
                         l7 += 36;
-                        j8 = 13;
+                        k8 = 13;
                     }
 
                     if (entityplayer.func_71024_bL().func_75115_e() <= 0.0F && this.field_73837_f % (k * 3 + 1) == 0)
                     {
-                        i7 = k1 + (this.field_73842_c.nextInt(3) - 1);
+                        j7 = k1 + (this.field_73842_c.nextInt(3) - 1);
                     }
 
                     if (flag1)
                     {
-                        j8 = 1;
+                        k8 = 1;
                     }
 
-                    int i9 = j1 - k6 * 8 - 9;
-                    this.func_73729_b(i9, i7, 16 + j8 * 9, 27, 9, 9);
+                    int j9 = j1 - k6 * 8 - 9;
+                    this.func_73729_b(j9, j7, 16 + k8 * 9, 27, 9, 9);
 
                     if (flag1)
                     {
                         if (k6 * 2 + 1 < l)
                         {
-                            this.func_73729_b(i9, i7, l7 + 54, 27, 9, 9);
+                            this.func_73729_b(j9, j7, l7 + 54, 27, 9, 9);
                         }
 
                         if (k6 * 2 + 1 == l)
                         {
-                            this.func_73729_b(i9, i7, l7 + 63, 27, 9, 9);
+                            this.func_73729_b(j9, j7, l7 + 63, 27, 9, 9);
                         }
                     }
 
                     if (k6 * 2 + 1 < k)
                     {
-                        this.func_73729_b(i9, i7, l7 + 36, 27, 9, 9);
+                        this.func_73729_b(j9, j7, l7 + 36, 27, 9, 9);
                     }
 
                     if (k6 * 2 + 1 == k)
                     {
-                        this.func_73729_b(i9, i7, l7 + 45, 27, 9, 9);
+                        this.func_73729_b(j9, j7, l7 + 45, 27, 9, 9);
                     }
                 }
             }
@@ -796,21 +836,21 @@
             {
                 this.field_73839_d.field_71424_I.func_76318_c("mountHealth");
                 EntityLivingBase entitylivingbase = (EntityLivingBase)entity;
-                int j7 = (int)Math.ceil((double)entitylivingbase.func_110143_aJ());
+                int i7 = (int)Math.ceil((double)entitylivingbase.func_110143_aJ());
                 float f3 = entitylivingbase.func_110138_aP();
-                int k8 = (int)(f3 + 0.5F) / 2;
+                int j8 = (int)(f3 + 0.5F) / 2;
 
-                if (k8 > 30)
+                if (j8 > 30)
                 {
-                    k8 = 30;
+                    j8 = 30;
                 }
 
-                int j9 = k1;
+                int i9 = k1;
 
-                for (int k9 = 0; k8 > 0; k9 += 20)
+                for (int k9 = 0; j8 > 0; k9 += 20)
                 {
-                    int l4 = Math.min(k8, 10);
-                    k8 -= l4;
+                    int l4 = Math.min(j8, 10);
+                    j8 -= l4;
 
                     for (int i5 = 0; i5 < l4; ++i5)
                     {
@@ -823,20 +863,20 @@
                         }
 
                         int l5 = j1 - i5 * 8 - 9;
-                        this.func_73729_b(l5, j9, j5 + k5 * 9, 9, 9, 9);
+                        this.func_73729_b(l5, i9, j5 + k5 * 9, 9, 9, 9);
 
-                        if (i5 * 2 + 1 + k9 < j7)
+                        if (i5 * 2 + 1 + k9 < i7)
                         {
-                            this.func_73729_b(l5, j9, j5 + 36, 9, 9, 9);
+                            this.func_73729_b(l5, i9, j5 + 36, 9, 9, 9);
                         }
 
-                        if (i5 * 2 + 1 + k9 == j7)
+                        if (i5 * 2 + 1 + k9 == i7)
                         {
-                            this.func_73729_b(l5, j9, j5 + 45, 9, 9, 9);
+                            this.func_73729_b(l5, i9, j5 + 45, 9, 9, 9);
                         }
                     }
 
-                    j9 -= 10;
+                    i9 -= 10;
                 }
             }
 
@@ -865,9 +905,12 @@
         }
     }
 
+    /**
+     * Renders dragon's (boss) health on the HUD
+     */
     protected void func_73828_d()
     {
-        if (BossStatus.field_82827_c != null && BossStatus.field_82826_b > 0)
+        if (BossStatus.field_82827_c != null && BossStatus.field_82826_b > 0 && Wrapper.getInstance().isBossBar())
         {
             --BossStatus.field_82826_b;
             FontRenderer fontrenderer = this.field_73839_d.field_71466_p;
@@ -914,51 +957,62 @@
         GlStateManager.func_179131_c(1.0F, 1.0F, 1.0F, 1.0F);
     }
 
+    /**
+     * Renders a Vignette arount the entire screen that changes with light level.
+     */
     protected void func_180480_a(float p_180480_1_, ScaledResolution p_180480_2_)
     {
-        p_180480_1_ = 1.0F - p_180480_1_;
-        p_180480_1_ = MathHelper.func_76131_a(p_180480_1_, 0.0F, 1.0F);
-        WorldBorder worldborder = this.field_73839_d.field_71441_e.func_175723_af();
-        float f = (float)worldborder.func_177745_a(this.field_73839_d.field_71439_g);
-        double d0 = Math.min(worldborder.func_177749_o() * (double)worldborder.func_177740_p() * 1000.0D, Math.abs(worldborder.func_177751_j() - worldborder.func_177741_h()));
-        double d1 = Math.max((double)worldborder.func_177748_q(), d0);
-
-        if ((double)f < d1)
+        if (!Config.isVignetteEnabled())
         {
-            f = 1.0F - (float)((double)f / d1);
+            GlStateManager.func_179126_j();
+            GlStateManager.func_179120_a(770, 771, 1, 0);
         }
         else
         {
-            f = 0.0F;
-        }
+            p_180480_1_ = 1.0F - p_180480_1_;
+            p_180480_1_ = MathHelper.func_76131_a(p_180480_1_, 0.0F, 1.0F);
+            WorldBorder worldborder = this.field_73839_d.field_71441_e.func_175723_af();
+            float f = (float)worldborder.func_177745_a(this.field_73839_d.field_71439_g);
+            double d0 = Math.min(worldborder.func_177749_o() * (double)worldborder.func_177740_p() * 1000.0D, Math.abs(worldborder.func_177751_j() - worldborder.func_177741_h()));
+            double d1 = Math.max((double)worldborder.func_177748_q(), d0);
 
-        this.field_73843_a = (float)((double)this.field_73843_a + (double)(p_180480_1_ - this.field_73843_a) * 0.01D);
-        GlStateManager.func_179097_i();
-        GlStateManager.func_179132_a(false);
-        GlStateManager.func_179120_a(0, 769, 1, 0);
+            if ((double)f < d1)
+            {
+                f = 1.0F - (float)((double)f / d1);
+            }
+            else
+            {
+                f = 0.0F;
+            }
 
-        if (f > 0.0F)
-        {
-            GlStateManager.func_179131_c(0.0F, f, f, 1.0F);
-        }
-        else
-        {
-            GlStateManager.func_179131_c(this.field_73843_a, this.field_73843_a, this.field_73843_a, 1.0F);
-        }
+            this.field_73843_a = (float)((double)this.field_73843_a + (double)(p_180480_1_ - this.field_73843_a) * 0.01D);
+            GlStateManager.func_179097_i();
+            GlStateManager.func_179132_a(false);
+            GlStateManager.func_179120_a(0, 769, 1, 0);
 
-        this.field_73839_d.func_110434_K().func_110577_a(field_110329_b);
-        Tessellator tessellator = Tessellator.func_178181_a();
-        WorldRenderer worldrenderer = tessellator.func_178180_c();
-        worldrenderer.func_181668_a(7, DefaultVertexFormats.field_181707_g);
-        worldrenderer.func_181662_b(0.0D, (double)p_180480_2_.func_78328_b(), -90.0D).func_181673_a(0.0D, 1.0D).func_181675_d();
-        worldrenderer.func_181662_b((double)p_180480_2_.func_78326_a(), (double)p_180480_2_.func_78328_b(), -90.0D).func_181673_a(1.0D, 1.0D).func_181675_d();
-        worldrenderer.func_181662_b((double)p_180480_2_.func_78326_a(), 0.0D, -90.0D).func_181673_a(1.0D, 0.0D).func_181675_d();
-        worldrenderer.func_181662_b(0.0D, 0.0D, -90.0D).func_181673_a(0.0D, 0.0D).func_181675_d();
-        tessellator.func_78381_a();
-        GlStateManager.func_179132_a(true);
-        GlStateManager.func_179126_j();
-        GlStateManager.func_179131_c(1.0F, 1.0F, 1.0F, 1.0F);
-        GlStateManager.func_179120_a(770, 771, 1, 0);
+            if (f > 0.0F)
+            {
+                GlStateManager.func_179131_c(0.0F, f, f, 1.0F);
+            }
+            else
+            {
+                GlStateManager.func_179131_c(this.field_73843_a, this.field_73843_a, this.field_73843_a, 1.0F);
+            }
+
+            this.field_73839_d.func_110434_K().func_110577_a(field_110329_b);
+            Tessellator tessellator = Tessellator.func_178181_a();
+            WorldRenderer worldrenderer = tessellator.func_178180_c();
+            worldrenderer.func_181668_a(7, DefaultVertexFormats.field_181707_g);
+            worldrenderer.func_181662_b(0.0D, (double)p_180480_2_.func_78328_b(), -90.0D).func_181673_a(0.0D, 1.0D).func_181675_d();
+            worldrenderer.func_181662_b((double)p_180480_2_.func_78326_a(), (double)p_180480_2_.func_78328_b(), -90.0D).func_181673_a(1.0D, 1.0D).func_181675_d();
+            worldrenderer.func_181662_b((double)p_180480_2_.func_78326_a(), 0.0D, -90.0D).func_181673_a(1.0D, 0.0D).func_181675_d();
+            worldrenderer.func_181662_b(0.0D, 0.0D, -90.0D).func_181673_a(0.0D, 0.0D).func_181675_d();
+            tessellator.func_78381_a();
+            GlStateManager.func_179132_a(true);
+            GlStateManager.func_179126_j();
+            GlStateManager.func_179131_c(1.0F, 1.0F, 1.0F, 1.0F);
+            GlStateManager.func_179120_a(770, 771, 1, 0);
+        }
     }
 
     protected void func_180474_b(float p_180474_1_, ScaledResolution p_180474_2_)
@@ -995,7 +1049,7 @@
         GlStateManager.func_179131_c(1.0F, 1.0F, 1.0F, 1.0F);
     }
 
-    protected void func_175184_a(int p_175184_1_, int p_175184_2_, int p_175184_3_, float p_175184_4_, EntityPlayer p_175184_5_)
+    private void func_175184_a(int p_175184_1_, int p_175184_2_, int p_175184_3_, float p_175184_4_, EntityPlayer p_175184_5_)
     {
         ItemStack itemstack = p_175184_5_.field_71071_by.field_70462_a[p_175184_1_];
 
@@ -1023,6 +1077,9 @@
         }
     }
 
+    /**
+     * The update tick for the ingame UI
+     */
     public void func_73831_a()
     {
         if (this.field_73845_h > 0)
@@ -1126,6 +1183,9 @@
         this.func_110326_a(p_175188_1_.func_150260_c(), p_175188_2_);
     }
 
+    /**
+     * returns a pointer to the persistant Chat GUI, containing all previous chat messages and such
+     */
     public GuiNewChat func_146158_b()
     {
         return this.field_73840_e;
